<!-- OPENSPEC:START -->
# OpenSpec Instructions

These instructions are for AI assistants working in this project.

Always open `@/openspec/AGENTS.md` when the request:
- Mentions planning or proposals (words like proposal, spec, change, plan)
- Introduces new capabilities, breaking changes, architecture shifts, or big performance/security work
- Sounds ambiguous and you need the authoritative spec before coding

Use `@/openspec/AGENTS.md` to learn:
- How to create and apply change proposals
- Spec format and conventions
- Project structure and guidelines

Keep this managed block so 'openspec update' can refresh the instructions.

<!-- OPENSPEC:END -->
# TermuxForLinux é¡¹ç›®

## é¡¹ç›®æ¦‚è¿°

TermuxForLinux æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Android Termux ç¯å¢ƒä¸­å®‰è£…å’Œè¿è¡Œå¤šç§ Linux å‘è¡Œç‰ˆçš„å·¥å…·é›†ã€‚è¯¥é¡¹ç›®ä½¿ç”¨ Rust å®ç°ï¼Œæ”¯æŒå¤šç³»ç»Ÿå¹¶è¡Œå®‰è£…ã€è‡ªå®šä¹‰å‘½åå’Œç²¾ç»†åŒ–é…ç½®ã€‚å¯ä»¥è½»æ¾åœ°åœ¨ Termux ä¸­å®‰è£…ã€ç®¡ç†å’Œå¸è½½ä¸åŒçš„ Linux å‘è¡Œç‰ˆï¼ŒåŒ…æ‹¬ Ubuntuã€Kaliã€Debianã€CentOS å’Œ Fedoraã€‚Rust ç‰ˆæœ¬æä¾›äº†æ›´å¥½çš„æ€§èƒ½ã€å†…å­˜å®‰å…¨æ€§å’Œç±»å‹å®‰å…¨ã€‚

## é¡¹ç›®ç»“æ„

```
/root/TermuxForLinux/

â”œâ”€â”€ Cargo.toml               # Rust é¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ Cargo.lock               # Rust ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ .gitignore               # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ README.md                # è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ IFLOW.md                 # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ openspec/                # OpenSpec è§„èŒƒç›®å½•
â”‚   â”œâ”€â”€ AGENTS.md           # OpenSpec ä»£ç†æŒ‡å—
â”‚   â”œâ”€â”€ project.md          # é¡¹ç›®çº¦å®š
â”‚   â”œâ”€â”€ specs/              # å½“å‰è§„èŒƒ
â”‚   â””â”€â”€ changes/            # å˜æ›´ææ¡ˆ
â”‚       â””â”€â”€ enhance-ui-visuals/  # UI å¢å¼ºææ¡ˆ
â”œâ”€â”€ src/                     # Rust æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.rs              # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ cli.rs               # å‘½ä»¤è¡Œå‚æ•°å¤„ç†å’Œç”¨æˆ·äº¤äº’æ¨¡å—
â”‚   â”œâ”€â”€ distro.rs            # Linux å‘è¡Œç‰ˆç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ utils.rs             # é€šç”¨å·¥å…·å‡½æ•°æ¨¡å—
â”‚   â”œâ”€â”€ installer.rs         # ç³»ç»Ÿå®‰è£…é€»è¾‘æ¨¡å—
â”‚   â”œâ”€â”€ system.rs            # ç³»ç»Ÿç®¡ç†å’Œå…ƒæ•°æ®æ¨¡å—
â”‚   â”œâ”€â”€ config.rs            # é…ç½®æ–‡ä»¶ç®¡ç†æ¨¡å—
â”‚   â””â”€â”€ ui.rs                # ç”¨æˆ·ç•Œé¢å’Œæ˜¾ç¤ºæ¨¡å—
â”œâ”€â”€ target/                  # Rust ç¼–è¯‘è¾“å‡ºç›®å½•
â”‚   â””â”€â”€ release/             # å‘å¸ƒç‰ˆæœ¬è¾“å‡º
â”‚       â””â”€â”€ termux-linux-install  # Rust ç‰ˆæœ¬å¯æ‰§è¡Œæ–‡ä»¶
â””â”€â”€ $HOME/Ostermux/          # è¿è¡Œæ—¶ç”Ÿæˆç›®å½•ï¼ˆé¦–æ¬¡è¿è¡Œè‡ªåŠ¨åˆ›å»ºï¼‰
    â””â”€â”€ config               # ç»Ÿä¸€é…ç½®æ–‡ä»¶ï¼ˆé¦–æ¬¡è¿è¡Œè‡ªåŠ¨åˆ›å»ºï¼‰
```

## æ ¸å¿ƒåŠŸèƒ½

### 1. ä¸»ç¨‹åº

#### termux-linux-install
- **å…¨æ–°æ¶æ„**: æ”¯æŒå¤šç³»ç»Ÿå¹¶è¡Œç®¡ç†
- **å‘½ä»¤è¡Œæ”¯æŒ**: å®Œæ•´çš„CLIå‚æ•°æ”¯æŒ
- **äº¤äº’å¼ç•Œé¢**: ç®€åŒ–çš„4é€‰é¡¹ä¸»èœå•
- **è‡ªå®šä¹‰å‘½å**: æ”¯æŒç³»ç»Ÿè‡ªå®šä¹‰åç§°
- **ç²¾ç»†åŒ–å®‰è£…**: ä¸‰ç§å®‰è£…æ¨¡å¼ï¼ˆæœ€å°åŒ–ã€æ ‡å‡†ã€è‡ªå®šä¹‰ï¼‰
- **æ— å¤–éƒ¨ä¾èµ–**: ä»…ä½¿ç”¨Rustæ ‡å‡†åº“
- **å°å±å¹•é€‚é…**: ä¼˜åŒ–ç§»åŠ¨ç»ˆç«¯æ˜¾ç¤ºæ•ˆæœ
- **è¿›åº¦åé¦ˆ**: å®‰è£…è¿‡ç¨‹æ˜¾ç¤ºå®æ—¶è¿›åº¦æ¡

### 2. å‘½ä»¤è¡Œæ¥å£

```bash
# äº¤äº’å¼ç•Œé¢
./termux-linux-install

# åˆ—å‡ºå·²å®‰è£…ç³»ç»Ÿ
./termux-linux-install --list

# å®‰è£…æŒ‡å®šå‘è¡Œç‰ˆ
./termux-linux-install --install ubuntu --name "å¼€å‘ç¯å¢ƒ"

# æœ€å°åŒ–å®‰è£…
./termux-linux-install --install debian --minimal

# å¸è½½æŒ‡å®šç³»ç»Ÿ
./termux-linux-install --uninstall debian1

# æ˜¾ç¤ºå¸®åŠ©
./termux-linux-install --help
```

### 3. å¯åŠ¨è„šæœ¬

ç»Ÿä¸€çš„å¯åŠ¨è„šæœ¬ `start.sh`ï¼Œä½¿ç”¨ proot æŠ€æœ¯åœ¨ Termux ç¯å¢ƒä¸­åˆ›å»ºå®¹å™¨åŒ–çš„ Linux ç¯å¢ƒï¼š
- è®¾ç½® proot ç¯å¢ƒ
- æŒ‚è½½å¿…è¦çš„ç³»ç»Ÿç›®å½• (/dev, /proc)
- é…ç½®ç¯å¢ƒå˜é‡ (PATH, HOME, TERM, LANG)
- å¯åŠ¨ bash shell
- æ”¯æŒå‘½ä»¤å‚æ•°ä¼ é€’

### 4. é…ç½®æ–‡ä»¶ç®¡ç†

é€šè¿‡ `config` æ–‡ä»¶ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å‘è¡Œç‰ˆçš„é…ç½®ï¼š
- æ”¯æŒè‡ªå®šä¹‰é•œåƒæºURL
- æ”¯æŒè‡ªå®šä¹‰ä¸‹è½½é“¾æ¥
- é»˜è®¤ä½¿ç”¨å›½å†…ä¼˜åŒ–é•œåƒæº
- é¦–æ¬¡è¿è¡Œè‡ªåŠ¨åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶æ ¼å¼ï¼š
```bash
# é•œåƒæºé…ç½®
ubuntu-mirror = https://mirrors.ustc.edu.cn/ubuntu/
debian-mirror = https://mirrors.163.com/debian/
kali-mirror = http://http.kali.org/kali/
centos-mirror = https://mirrors.aliyun.com/centos/
fedora-mirror = https://mirrors.tuna.tsinghua.edu.cn/fedora/

# è‡ªå®šä¹‰ä¸‹è½½é“¾æ¥é…ç½®ï¼ˆå¯é€‰ï¼‰
# ubuntu-link = https://custom-mirror.com/ubuntu-rootfs-arm64.tar.xz
# debian-link = https://custom-mirror.com/debian-rootfs-arm64.tar.xz
# kali-link = https://custom-mirror.com/kali-rootfs-arm64.tar.xz
# centos-link = https://custom-mirror.com/centos-rootfs-arm64.tar.xz
# fedora-link = https://custom-mirror.com/fedora-rootfs-arm64.tar.xz
```

## ä½¿ç”¨æ–¹æ³•

### å®‰è£…ä¾èµ–

```bash
pkg install screenfetch -y
```

### ç¼–è¯‘å’Œè¿è¡Œ

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd TermuxForLinux

# ç¼–è¯‘å‘å¸ƒç‰ˆæœ¬
cargo build --release

# è¿è¡Œç¨‹åº
./target/release/termux-linux-install
```

### äº¤äº’å¼å®‰è£…

1. è¿è¡Œç¨‹åºé€‰æ‹©"å®‰è£…ç³»ç»Ÿ"
2. é€‰æ‹©è¦å®‰è£…çš„Linuxå‘è¡Œç‰ˆ
3. è¾“å…¥è‡ªå®šä¹‰ç³»ç»Ÿåç§°ï¼ˆå¯é€‰ï¼‰
4. é€‰æ‹©å®‰è£…æ¨¡å¼ï¼š
   - æœ€å°åŒ–å®‰è£…
   - æ ‡å‡†å®‰è£…
   - è‡ªå®šä¹‰å®‰è£…

### å¯åŠ¨å·²å®‰è£…çš„ç³»ç»Ÿ

```bash
cd $HOME/Ostermux/debian1
./start.sh

# æˆ–ç›´æ¥ä¼ é€’å‘½ä»¤
./start.sh "ls -la"
```

### é…ç½®æ–‡ä»¶

ç¼–è¾‘ `$HOME/Ostermux/config` æ–‡ä»¶ï¼š
```bash
# é•œåƒæºé…ç½®
ubuntu-mirror = https://mirrors.ustc.edu.cn/ubuntu/
debian-mirror = https://mirrors.163.com/debian/

# è‡ªå®šä¹‰ä¸‹è½½é“¾æ¥ï¼ˆå¯é€‰ï¼‰
ubuntu-link = https://your-custom-mirror.com/ubuntu-rootfs-arm64.tar.xz
```

**æ³¨æ„**ï¼š
- é¦–æ¬¡è¿è¡Œç¨‹åºä¼šè‡ªåŠ¨åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶
- é…ç½®æ–‡ä»¶ä½ç½®ï¼š`$HOME/Ostermux/config`

## æŠ€æœ¯å®ç°

- **å¤šç³»ç»Ÿæ¶æ„**: é€šè¿‡ç‹¬ç«‹ç›®å½•å’Œå…ƒæ•°æ®ç®¡ç†å¤šä¸ªç³»ç»Ÿå®ä¾‹
- **å®¹å™¨åŒ–æŠ€æœ¯**: ä½¿ç”¨ proot å®ç°ç”¨æˆ·ç©ºé—´çš„å®¹å™¨åŒ–ï¼Œæ— éœ€ root æƒé™
- **å…ƒæ•°æ®ç®¡ç†**: é€šè¿‡ `meta.txt` å­˜å‚¨ç³»ç»Ÿä¿¡æ¯å’Œé…ç½®
- **å“åº”å¼ç•Œé¢**: è‡ªé€‚åº”ç»ˆç«¯å®½åº¦çš„æ˜¾ç¤ºæ•ˆæœ
- **é…ç½®é©±åŠ¨**: é€šè¿‡ç»Ÿä¸€ `config` æ–‡ä»¶ç®¡ç†é•œåƒæºå’Œä¸‹è½½é“¾æ¥
- **ä¼˜åŒ–çš„IDç”Ÿæˆ**: ä½¿ç”¨å“ˆå¸Œé›†åˆå¿«é€Ÿç”Ÿæˆå”¯ä¸€å®ä¾‹ID
- **è‡ªåŠ¨å›é€€æœºåˆ¶**: è‡ªå®šä¹‰é“¾æ¥å¤±æ•ˆæ—¶è‡ªåŠ¨ä½¿ç”¨é»˜è®¤ä¸‹è½½æº
- **æƒé™å¤„ç†**: è§£å‹æ—¶ä½¿ç”¨ `--no-same-owner` å‚æ•°é¿å…æƒé™é—®é¢˜

### Rust ç‰ˆæœ¬æŠ€æœ¯ç‰¹ç‚¹

- **å†…å­˜å®‰å…¨**: Rust çš„æ‰€æœ‰æƒç³»ç»Ÿç¡®ä¿å†…å­˜å®‰å…¨
- **é›¶æˆæœ¬æŠ½è±¡**: é«˜çº§æŠ½è±¡ä¸ä¼šå¸¦æ¥è¿è¡Œæ—¶å¼€é”€
- **ç±»å‹å®‰å…¨**: å¼ºç±»å‹ç³»ç»Ÿåœ¨ç¼–è¯‘æ—¶æ•è·é”™è¯¯
- **æ¨¡å—åŒ–æ¶æ„**: æ¸…æ™°çš„æ¨¡å—åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **æ ‡å‡†åº“ä¼˜å…ˆ**: ä»…ä½¿ç”¨æ ‡å‡†åº“ï¼Œå‡å°‘ä¾èµ–å¤æ‚åº¦
- **æ€§èƒ½ä¼˜åŒ–**: å‘å¸ƒç‰ˆæœ¬ç»è¿‡ LTO å’Œå…¶ä»–ä¼˜åŒ–æŠ€æœ¯å¤„ç†

### æ¨¡å—åŒ–æ¶æ„ä¼˜åŠ¿

1. **å¯ç»´æŠ¤æ€§**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œä¾¿äºå®šä½å’Œä¿®æ”¹é—®é¢˜
2. **å¯æ‰©å±•æ€§**: æ–°åŠŸèƒ½å¯ä»¥é€šè¿‡æ·»åŠ æ–°æ¨¡å—å®ç°ï¼Œä¸å½±å“ç°æœ‰ä»£ç 
3. **å¯é‡ç”¨æ€§**: æ¨¡å—å¯ä»¥åœ¨ä¸åŒé¡¹ç›®ä¸­é‡ç”¨
4. **å›¢é˜Ÿåä½œ**: ä¸åŒå¼€å‘è€…å¯ä»¥ç‹¬ç«‹å¼€å‘ä¸åŒæ¨¡å—
5. **æµ‹è¯•å‹å¥½**: æ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹æµ‹è¯•ï¼Œæé«˜ä»£ç è´¨é‡
6. **æ€§èƒ½ä¼˜åŒ–**: æ¨¡å—åŒ–è®¾è®¡å…è®¸é’ˆå¯¹ç‰¹å®šæ¨¡å—è¿›è¡Œæ€§èƒ½ä¼˜åŒ–

## å¼€å‘çº¦å®š

- **å¤šç³»ç»Ÿæ”¯æŒ**: æ‰€æœ‰åŠŸèƒ½æ”¯æŒå¤šå®ä¾‹å¹¶è¡Œè¿è¡Œ
- **ç»Ÿä¸€æ¥å£**: å‘½ä»¤è¡Œå’Œäº¤äº’å¼ç•Œé¢åŠŸèƒ½ä¸€è‡´
- **é…ç½®é©±åŠ¨**: å…³é”®é…ç½®é€šè¿‡æ–‡ä»¶ç®¡ç†ï¼Œä¾¿äºå®šåˆ¶
- **å“åº”å¼è®¾è®¡**: ç•Œé¢é€‚é…ä¸åŒå±å¹•å°ºå¯¸
- **å‘åå…¼å®¹**: ä¿æŒä¸æ—§ç‰ˆæœ¬çš„åŸºæœ¬å…¼å®¹æ€§

### ä»£ç ç»“æ„çº¦å®š

- **main.rs**: ä¸»ç¨‹åºå…¥å£ï¼Œä»…è´Ÿè´£æ¨¡å—åˆå§‹åŒ–å’Œç¨‹åºå¯åŠ¨
- **cli.rs**: å‘½ä»¤è¡Œå‚æ•°å¤„ç†ã€äº¤äº’å¼èœå•ã€ç”¨æˆ·è¾“å…¥å¤„ç†
- **distro.rs**: Linux å‘è¡Œç‰ˆå®šä¹‰ã€ç³»ç»Ÿå…ƒæ•°æ®ã€å®‰è£…é…ç½®
- **utils.rs**: é€šç”¨å·¥å…·å‡½æ•°ã€æ–‡ä»¶æ“ä½œã€å‘½ä»¤æ‰§è¡Œ
- **installer.rs**: ç³»ç»Ÿå®‰è£…æµç¨‹ã€é•œåƒä¸‹è½½ã€è§£å‹å’Œé…ç½®
- **system.rs**: ç³»ç»Ÿç®¡ç†ã€å¸è½½é€»è¾‘ã€ç³»ç»Ÿå®ä¾‹ç®¡ç†
- **config.rs**: é…ç½®æ–‡ä»¶ç®¡ç†ã€é•œåƒæºé…ç½®
- **ui.rs**: ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºã€æ ¼å¼åŒ–è¾“å‡ºã€ç»ˆç«¯é€‚é…ã€è¿›åº¦æ¡ç»„ä»¶
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€ä½¿ç”¨ `Result<T, E>` ç±»å‹
- **ä»£ç é£æ ¼**: éµå¾ª Rust å®˜æ–¹ä»£ç é£æ ¼å’Œå‘½åçº¦å®š

### æ¨¡å—åŒ–è®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªç‰¹å®šåŠŸèƒ½é¢†åŸŸ
2. **ä½è€¦åˆ**: æ¨¡å—é—´ä¾èµ–æœ€å°åŒ–ï¼Œé€šè¿‡å…¬å…±æ¥å£é€šä¿¡
3. **é«˜å†…èš**: ç›¸å…³åŠŸèƒ½é›†ä¸­åœ¨åŒä¸€æ¨¡å—å†…
4. **å¯æ‰©å±•æ€§**: æ–°åŠŸèƒ½å¯ä»¥é€šè¿‡æ·»åŠ æ–°æ¨¡å—æˆ–æ‰©å±•ç°æœ‰æ¨¡å—å®ç°
5. **å¯æµ‹è¯•æ€§**: æ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•

## OpenSpec å·¥ä½œæµ

æœ¬é¡¹ç›®ä½¿ç”¨ OpenSpec è¿›è¡Œè§„èŒƒé©±åŠ¨çš„å¼€å‘ï¼š

### æŸ¥çœ‹å½“å‰å˜æ›´

```bash
# åˆ—å‡ºæ´»è·ƒå˜æ›´
openspec list

# æŸ¥çœ‹å˜æ›´è¯¦æƒ…
openspec show <change-id>
```

### åˆ›å»ºæ–°å˜æ›´

```bash
# åˆ›å»ºå˜æ›´ç›®å½•
mkdir -p openspec/changes/<change-name>/specs/<capability>

# ç¼–å†™ææ¡ˆæ–‡ä»¶
echo "## Why\n...\n\n## What Changes\n- ...\n\n## Impact\n- ..." > openspec/changes/<change-name>/proposal.md

# ç¼–å†™ä»»åŠ¡æ¸…å•
echo "## 1. Implementation\n- [ ] 1.1 ...\n- [ ] 1.2 ..." > openspec/changes/<change-name>/tasks.md

# ç¼–å†™è§„èŒƒå˜æ›´
echo "## ADDED Requirements\n### Requirement: ...\n..." > openspec/changes/<change-name>/specs/<capability>/spec.md

# éªŒè¯å˜æ›´
openspec validate <change-name> --strict
```

### åº”ç”¨å˜æ›´

```bash
# å®ç°å˜æ›´åå½’æ¡£
openspec archive <change-name> --yes
```

## æ³¨æ„äº‹é¡¹

1. å®‰è£…è¿‡ç¨‹éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
2. é¦–æ¬¡å®‰è£…ä¼šä¸‹è½½è¾ƒå¤§çš„æ ¹æ–‡ä»¶ç³»ç»Ÿå‹ç¼©åŒ…
3. å„å‘è¡Œç‰ˆç‹¬ç«‹å­˜å‚¨åœ¨ `$HOME/Ostermux/` ç›®å½•ä¸‹
4. ç³»ç»ŸIDè‡ªåŠ¨ç”Ÿæˆï¼Œæ ¼å¼ä¸º `{DISTRO}{NUMBER}`
5. æ”¯æŒå°å±å¹•ç»ˆç«¯æ“ä½œï¼Œç•Œé¢è‡ªé€‚åº”å®½åº¦
6. é…ç½®æ–‡ä»¶æ”¯æŒè‡ªå®šä¹‰ï¼Œé»˜è®¤ä½¿ç”¨å›½å†…ä¼˜åŒ–æº
7. é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨åˆ›å»º `$HOME/Ostermux/config` é…ç½®æ–‡ä»¶
8. è‡ªå®šä¹‰ä¸‹è½½é“¾æ¥å¤±æ•ˆæ—¶ä¼šè‡ªåŠ¨å›é€€åˆ°é»˜è®¤æº

## ç‰ˆæœ¬æ›´æ–°è®°å½•

### v0.1.1 (å½“å‰ç‰ˆæœ¬)
- âœ… ä¿®å¤Termuxä¸­ç¡¬é“¾æ¥è§£å‹é—®é¢˜ï¼Œä½¿ç”¨ `proot --link2symlink`
- âœ… å‚è€ƒproot-distroé¡¹ç›®å®ç°ï¼Œæ·»åŠ  `--delay-directory-restore` å’Œ `--preserve-permissions` é€‰é¡¹
- âœ… æ·»åŠ  `--exclude='dev'` æ’é™¤è®¾å¤‡æ–‡ä»¶
- âœ… ä¿®å¤æ‰€æœ‰ç¼–è¯‘è­¦å‘Šï¼Œä¼˜åŒ–ä»£ç è´¨é‡

### v0.1.2 (å¼€å‘ä¸­)
- ğŸ”„ UIç•Œé¢ä¼˜åŒ–ï¼šç§»é™¤è¾¹æ¡†ï¼Œæ·»åŠ è¿›åº¦æ¡
- ğŸ”„ æ”¹è¿›æ–‡æœ¬æ’ç‰ˆå’Œè§†è§‰å±‚æ¬¡
- ğŸ”„ å¢å¼ºç”¨æˆ·æ“ä½œåé¦ˆ